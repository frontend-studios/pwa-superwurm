<template>
  <MegaMenu :categories="categoryTree">
    <template #navbar-content>
      <nav class="flex md:flex-row md:flex-nowrap items-center">
        <UiButton
          v-if="viewport.isLessThan('lg')"
          variant="tertiary"
          class="group relative text-white hover:text-white active:text-white hover:bg-primary-800 active:bg-primary-700 mr-1 -ml-0.5 rounded-md cursor-pointer"
          square
          :aria-label="t('openSearchModalButtonLabel')"
          @click="searchModalOpen"
        >
          <SfIconSearch />
        </UiButton>

        <UiSearch class="opensearch flex-1 mr-2 z-20" v-if="viewport.isGreaterOrEquals('lg')" />

        <!-- Modal toggle -->
        <UiButton
          @click="openContactModal"
          class="group relative z-10 text-white hover:text-white active:text-white hover:bg-primary-800 active:bg-primary-700 mr-1 -ml-0.5 rounded-md cursor-pointer"
          variant="tertiary"
          square
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink"
            width="16px"
            height="14px"
            viewBox="0 0 16 14"
            version="1.1"
          >
            <g id="Page-1" stroke="none" stroke-width="2" fill="none" fill-rule="evenodd">
              <g id="Artboard" transform="translate(-1, 0)" stroke="#FFFFFF" stroke-width="2">
                <g id="noun-chat-336479" transform="translate(2, 1)">
                  <path
                    d="M4.866,1.631 C4.866,0.731 5.597,8.8817842e-16 6.497,8.8817842e-16 L12.235,8.8817842e-16 C13.135,8.8817842e-16 13.866,0.731 13.866,1.631 L13.866,4.893 C13.866,5.794 13.135,6.524 12.235,6.524 L11.123,6.524 L12.066,8.513 L9.591,6.524 L6.497,6.524 C5.597,6.524 4.866,5.794 4.866,4.893 L4.866,3.224 L4.866,1.631 Z"
                    id="Path"
                  ></path>
                  <path
                    d="M4.866,3.228 L4.866,4.893 C4.866,5.794 5.597,6.524 6.497,6.524 L9,6.524 L9,8.122 C9,9.022 8.269,9.753 7.369,9.753 L4.275,9.753 L1.8,11.742 L2.925,9.753 L1.631,9.753 C0.731,9.753 8.8817842e-16,9.022 8.8817842e-16,8.122 L8.8817842e-16,4.859 C8.8817842e-16,3.959 0.731,3.228 1.631,3.228 L4.866,3.228 Z"
                    id="Path"
                  ></path>
                </g>
              </g>
            </g>
          </svg>
          <span class="hidden md:inline text-sm">Kundensupport</span>
        </UiButton>
        <!-- Main modal -->
        <UiModal
          v-if="viewport.isGreaterOrEquals('md') && isContactModalOpen"
          v-model="isContactModalOpen"
          tag="section"
          class="h-full md:w-[500px] md:h-fit m-0 p-0 overflow-y-auto"
        >
          <header>
            <UiButton
              :aria-label="$t('closeDialog')"
              square
              variant="tertiary"
              class="absolute right-2 top-2"
              @click="closeContactModal"
            >
              <SfIconClose />
            </UiButton>
          </header>
          <div class="p-4">
            <p id="h3 contact-modal-title" class="font-bold typography-headline-4 mb-4">Contact Header</p>
            <p>Lorem Ipsum zeug</p>
          </div>
        </UiModal>

        <UiButton
          v-if="viewport.isLessThan('lg') && viewport.isGreaterOrEquals('md')"
          class="group relative text-white hover:text-white active:text-white hover:bg-primary-800 active:bg-primary-700 mr-1 -ml-0.5 rounded-md"
          :tag="NuxtLink"
          :to="localePath(paths.wishlist)"
          :aria-label="t('numberInWishlist', { count: wishlistItemIds.length })"
          variant="tertiary"
          square
          data-testid="wishlist-page-navigation"
        >
          <template #prefix>
            <SfIconFavorite />
            {{ wishlistItemIds.length }}
          </template>
        </UiButton>

        <SfDropdown
          v-if="isAuthorized && viewport.isLessThan('lg')"
          v-model="isAccountDropdownOpen"
          placement="bottom-end"
          class="z-50"
        >
          <template #trigger>
            <UiButton
              variant="tertiary"
              class="relative text-white hover:text-white active:text-white hover:bg-primary-800 active:bg-primary-700 rounded-md"
              :class="{ 'bg-primary-700': isAccountDropdownOpen }"
              data-testid="account-dropdown-button"
              @click="accountDropdownToggle()"
            >
              <template #prefix>
                <SfIconPerson />
              </template>
              {{ user.user?.firstName }}
            </UiButton>
          </template>
          <ul class="rounded bg-white shadow-md border border-neutral-100 text-neutral-900 min-w-[152px] py-2">
            <li v-for="({ label, link }, labelIndex) in accountDropdown" :key="`label-${labelIndex}`">
              <template v-if="label === t('account.logout')">
                <UiDivider class="my-2" />
                <SfListItem tag="button" class="text-left" data-testid="account-dropdown-logout-item" @click="logOut()">
                  {{ label }}
                </SfListItem>
              </template>
              <SfListItem
                v-else
                :tag="NuxtLink"
                :to="link"
                :class="{ 'bg-neutral-200': route.path === link }"
                data-testid="account-dropdown-list-item"
              >
                {{ label }}
              </SfListItem>
            </li>
          </ul>
        </SfDropdown>
        <UiButton
          v-else-if="viewport.isLessThan('lg')"
          class="group relative text-white hover:text-white active:text-white hover:bg-primary-800 active:bg-primary-700 mr-1 -ml-0.5 rounded-md"
          variant="tertiary"
          :aria-label="t('auth.login.openLoginForm')"
          square
          @click="navigateToLogin"
        >
          <SfIconPerson />
        </UiButton>

        <UiButton
          v-if="viewport.isLessThan('lg')"
          class="group relative text-white hover:text-white active:text-white hover:bg-primary-800 active:bg-primary-700 mr-1 -ml-0.5 rounded-md"
          :tag="NuxtLink"
          :to="localePath(paths.cart)"
          :aria-label="t('numberInCart', { count: cartItemsCount })"
          variant="tertiary"
          square
        >
          <p class="cartItemsCount">{{ cartItemsCount }}</p>
          <template #prefix>
            <svg
              v-if="cartItemsCount >= 0"
              xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              width="113px"
              class="inline-block fill-current w-6 h-6"
              viewBox="0 0 113 111"
              version="1.1"
            >
              <path
                d="M102.311854,34.6661377 L46.592854,34.6661377 L54.654854,65.4621377 L94.412854,65.6871377 L102.311854,34.6661377 Z M43.331854,29.3851377 C62.770854,30.2281377 83.737854,27.8891377 103.003854,29.2581377 C105.233854,29.4161377 108.793854,29.5921377 108.518854,32.5311377 C105.411854,42.1001377 103.614854,52.0611377 100.835854,61.7151377 C99.764854,65.4351377 99.459854,70.2061377 94.918854,70.6231377 C81.938854,71.8171377 67.161854,69.6701377 53.985854,70.6231377 C52.056854,70.7311377 50.405854,69.3611377 49.853854,67.5671377 C48.267854,56.7451377 41.930854,43.5001377 40.847854,32.9661377 C40.625854,30.8061377 41.133854,29.7831377 43.331854,29.3851377 L43.331854,29.3851377 Z"
              ></path>
              <path
                d="M105.470754,80.7955377 C109.902754,82.5945377 108.902754,90.3054637 104.514754,90.2275377 C85.791754,88.9725377 63.399754,91.3235377 44.916754,89.7265377 C38.570754,89.1785377 33.545754,82.4815377 31.576754,76.3965377 L16.587754,19.9175377 C16.057754,17.6245377 13.686754,16.4315377 11.478754,15.9665377 C8.72375404,15.3865377 -1.19724596,17.6215377 0.119754043,10.7145377 C0.809754043,7.09753767 9.76975404,6.11053767 12.074754,6.33753767 C21.577754,7.27353767 25.550754,16.6445377 27.389754,22.6795377 C32.304754,38.8025377 34.978754,55.3295377 40.489754,70.9955377 C42.197754,75.8505377 42.843754,79.5445377 48.436754,80.1745377 C65.921754,82.1415377 85.011754,78.6485377 102.842754,80.1525377 C103.622754,80.2185377 104.742754,80.5005377 105.470754,80.7955377 Z"
              ></path>
              <path
                d="M51.867354,96.9842377 C46.252354,98.2122377 47.985354,108.203238 54.282354,107.325238 C60.811354,106.415238 59.832354,95.2422377 51.867354,96.9842377"
              ></path>
              <path
                d="M85.781654,96.9875377 C79.231654,98.4175377 82.371654,108.283538 88.098654,107.241538 C94.700654,106.039538 93.704654,95.2585377 85.781654,96.9875377"
              ></path>
              <line x1="25.864854" y1="18.4374377" x2="17.210854" y2="22.2654377"></line>
              <line x1="32.738454" y1="40.6853377" x2="23.440454" y2="42.4403377"></line>
              <line x1="40.800254" y1="69.2401377" x2="31.502254" y2="70.9951377"></line>
              <line x1="47.055254" y1="81.7555377" x2="44.065254" y2="90.7335377"></line>
              <line x1="74.557854" y1="81.0870377" x2="74.776854" y2="90.5470377"></line>
              <line x1="97.489054" y1="81.0870377" x2="97.708054" y2="90.5470377"></line>
              <path
                d="M7.91035404,0.124437674 C4.11235404,0.955437674 5.28435404,7.71443767 9.54435404,7.12043767 C13.961354,6.50443767 13.299354,-1.05356233 7.91035404,0.124437674"
              ></path>
              <path
                d="M11.948654,3.70313767 C8.15065404,4.53413767 9.32265404,11.2931377 13.582654,10.6991377 C17.999654,10.0831377 17.337654,2.52513767 11.948654,3.70313767"
              ></path>
            </svg>
            <svg
              v-else
              version="1.1"
              viewBox="0 0 120 115"
              height="115px"
              width="120px"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              xmlns="http://www.w3.org/2000/svg"
            >
              <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                <g id="Shopping-Ansätze-02" transform="translate(-940, -367)">
                  <g id="Group-2" transform="translate(942.4545, 369.3792)">
                    <path
                      d="M102.311854,38.3911386 L46.593854,38.3911386 L54.654854,69.1871386 L94.412854,69.4121386 L102.311854,38.3911386 Z M43.331854,33.1101386 C62.770854,33.9531386 83.737854,31.6141386 103.003854,32.9831386 C105.233854,33.1411386 108.793854,33.3171386 108.518854,36.2561386 C105.411854,45.8251386 103.614854,55.7861386 100.835854,65.4401386 C99.764854,69.1601386 99.459854,73.9311386 94.918854,74.3481386 C81.938854,75.5421386 67.161854,73.3951386 53.985854,74.3481386 C52.056854,74.4561386 50.405854,73.0861386 49.854854,71.2921386 C48.267854,60.4701386 41.930854,47.2251386 40.847854,36.6911386 C40.625854,34.5311386 41.133854,33.5081386 43.331854,33.1101386 L43.331854,33.1101386 Z"
                      id="Fill-602"
                      fill="#574A34"
                    ></path>
                    <path
                      d="M102.311854,38.3911386 L46.593854,38.3911386 L54.654854,69.1871386 L94.412854,69.4121386 L102.311854,38.3911386 Z M43.331854,33.1101386 C62.770854,33.9531386 83.737854,31.6141386 103.003854,32.9831386 C105.233854,33.1411386 108.793854,33.3171386 108.518854,36.2561386 C105.411854,45.8251386 103.614854,55.7861386 100.835854,65.4401386 C99.764854,69.1601386 99.459854,73.9311386 94.918854,74.3481386 C81.938854,75.5421386 67.161854,73.3951386 53.985854,74.3481386 C52.056854,74.4561386 50.405854,73.0861386 49.854854,71.2921386 C48.267854,60.4701386 41.930854,47.2251386 40.847854,36.6911386 C40.625854,34.5311386 41.133854,33.5081386 43.331854,33.1101386 Z"
                      id="Stroke-604"
                      stroke="#574A34"
                      stroke-width="0.25"
                    ></path>
                    <path
                      d="M105.470754,84.5205386 C109.902754,86.3195386 108.902754,94.0304646 104.514754,93.9525386 C85.791754,92.6975386 63.399754,95.0485386 44.916754,93.4515386 C38.570754,92.9035386 33.545754,86.2065386 31.576754,80.1215386 L16.587754,23.6425386 C16.057754,21.3495386 13.686754,20.1565386 11.478754,19.6915386 C8.72375404,19.1115386 -1.19724596,21.3465386 0.119754043,14.4395386 C0.809754043,10.8225386 9.76975404,9.8355386 12.074754,10.0625386 C21.578754,10.9985386 25.550754,20.3695386 27.389754,26.4045386 C32.304754,42.5275386 34.978754,59.0545386 40.489754,74.7205386 C42.197754,79.5755386 42.843754,83.2695386 48.436754,83.8995386 C65.921754,85.8665386 85.011754,82.3735386 102.842754,83.8775386 C103.622754,83.9435386 104.743754,84.2255386 105.470754,84.5205386 Z"
                      id="Stroke-606"
                      stroke="#574A34"
                      stroke-width="4"
                    ></path>
                    <path
                      d="M51.867454,100.709239 C46.252454,101.937239 47.985454,111.928239 54.282454,111.050239 C60.811454,110.140239 59.832454,98.9672386 51.867454,100.709239"
                      id="Fill-608"
                      fill="#574A34"
                    ></path>
                    <path
                      d="M51.867454,100.709239 C46.252454,101.937239 47.985454,111.928239 54.282454,111.050239 C60.811454,110.140239 59.832454,98.9672386 51.867454,100.709239 Z"
                      id="Stroke-610"
                      stroke="#574A34"
                      stroke-width="1.521"
                    ></path>
                    <path
                      d="M85.781654,100.712539 C79.231654,102.142539 82.371654,112.008539 88.098654,110.966539 C94.700654,109.764539 93.704654,98.9835386 85.781654,100.712539"
                      id="Fill-612"
                      fill="#574A34"
                    ></path>
                    <path
                      d="M85.781654,100.712539 C79.231654,102.142539 82.371654,112.008539 88.098654,110.966539 C94.700654,109.764539 93.704654,98.9835386 85.781654,100.712539 Z"
                      id="Stroke-614"
                      stroke="#574A34"
                      stroke-width="1.523"
                    ></path>
                    <line
                      x1="25.864954"
                      y1="22.1624386"
                      x2="17.210954"
                      y2="25.9904386"
                      id="Stroke-616"
                      stroke="#574A34"
                      stroke-width="4"
                    ></line>
                    <line
                      x1="32.738454"
                      y1="44.4103386"
                      x2="23.440454"
                      y2="46.1653386"
                      id="Stroke-618"
                      stroke="#574A34"
                      stroke-width="4"
                    ></line>
                    <line
                      x1="40.800354"
                      y1="72.9651386"
                      x2="31.502354"
                      y2="74.7201386"
                      id="Stroke-620"
                      stroke="#574A34"
                      stroke-width="4"
                    ></line>
                    <line
                      x1="47.055254"
                      y1="85.4805386"
                      x2="44.065254"
                      y2="94.4585386"
                      id="Stroke-622"
                      stroke="#574A34"
                      stroke-width="4"
                    ></line>
                    <line
                      x1="74.557954"
                      y1="84.8120386"
                      x2="74.776954"
                      y2="94.2720386"
                      id="Stroke-624"
                      stroke="#574A34"
                      stroke-width="4"
                    ></line>
                    <line
                      x1="97.489054"
                      y1="84.8120386"
                      x2="97.708054"
                      y2="94.2720386"
                      id="Stroke-626"
                      stroke="#574A34"
                      stroke-width="4"
                    ></line>
                    <path
                      d="M7.91045404,3.8494386 C4.11245404,4.6804386 5.28445404,11.4394386 9.54445404,10.8454386 C13.961454,10.2294386 13.299454,2.6714386 7.91045404,3.8494386"
                      id="Fill-628"
                      fill="#EDE9DA"
                    ></path>
                    <path
                      d="M7.91045404,3.8494386 C4.11245404,4.6804386 5.28445404,11.4394386 9.54445404,10.8454386 C13.961454,10.2294386 13.299454,2.6714386 7.91045404,3.8494386 Z"
                      id="Stroke-630"
                      stroke="#574A34"
                      stroke-width="2.424"
                    ></path>
                    <path
                      d="M11.948754,7.4281386 C8.15075404,8.2591386 9.32275404,15.0181386 13.582754,14.4241386 C17.999754,13.8081386 17.337754,6.2501386 11.948754,7.4281386"
                      id="Fill-632"
                      fill="#EDE9DA"
                    ></path>
                    <path
                      d="M11.948754,7.4281386 C8.15075404,8.2591386 9.32275404,15.0181386 13.582754,14.4241386 C17.999754,13.8081386 17.337754,6.2501386 11.948754,7.4281386 Z"
                      id="Stroke-634"
                      stroke="#574A34"
                      stroke-width="2.424"
                    ></path>
                    <path
                      d="M27.533154,4.2983386 C27.533154,4.2983386 34.656154,1.6013386 36.182154,7.9063386 C37.707154,14.2113386 35.500154,15.9993386 38.158154,20.6163386 C40.815154,25.2333386 47.598154,27.1893386 46.467154,34.8303386"
                      id="Stroke-636"
                      stroke="#574A34"
                      stroke-width="3.172"
                      stroke-linecap="round"
                    ></path>
                    <g id="Group-641" transform="translate(42.3063, 5.7333)">
                      <path
                        d="M5.75052079,0 C5.75052079,0 -3.08847921,4.239 1.15052079,11.021 C5.38952079,17.804 13.0205208,22.869 7.65052079,29.097"
                        id="Fill-638"
                        fill="#EDE9DA"
                      ></path>
                      <path
                        d="M5.75052079,0 C5.75052079,0 -3.08847921,4.239 1.15052079,11.021 C5.38952079,17.804 13.0205208,22.869 7.65052079,29.097"
                        id="Stroke-640"
                        stroke="#574A34"
                        stroke-width="3.172"
                        stroke-linecap="round"
                      ></path>
                    </g>
                    <path
                      d="M50.695354,16.4977386 C50.695354,16.4977386 52.672354,11.7167386 56.165354,13.9237386 C59.659354,16.1297386 55.614354,20.5617386 57.085354,23.1267386 C58.556354,25.6917386 59.843354,31.6107386 56.349354,34.8107386"
                      id="Stroke-642"
                      stroke="#574A34"
                      stroke-width="3.172"
                      stroke-linecap="round"
                    ></path>
                    <path
                      d="M70.610354,35.0433386 C70.610354,35.0433386 61.207354,34.1883386 62.488354,26.3953386 C63.769354,18.6023386 68.692354,11.2223386 61.642354,7.3033386"
                      id="Stroke-644"
                      stroke="#574A34"
                      stroke-width="3.099"
                      stroke-linecap="round"
                    ></path>
                    <path
                      d="M72.653154,52.9043386 C72.653154,52.9043386 78.384154,50.5323386 76.819154,47.0383386 C75.254154,43.5443386 70.289154,38.1023386 72.653154,35.9163386"
                      id="Stroke-646"
                      stroke="#574A34"
                      stroke-width="3.099"
                      stroke-linecap="round"
                    ></path>
                    <path
                      d="M96.764854,34.1902386 C96.764854,34.1902386 92.338854,30.5372386 94.627854,27.5362386 C96.916854,24.5352386 102.706854,20.4632386 101.196854,17.7902386"
                      id="Stroke-648"
                      stroke="#574A34"
                      stroke-width="2.96"
                      stroke-linecap="round"
                    ></path>
                    <path
                      d="M115.849154,52.0314386 C115.849154,52.0314386 109.221154,50.5684386 110.989154,44.4104386 C112.756154,38.2524386 114.808154,31.4044386 110.689154,29.8574386 C106.570154,28.3114386 100.577154,33.4414386 101.444154,35.9164386"
                      id="Stroke-650"
                      stroke="#574A34"
                      stroke-width="2.96"
                      stroke-linecap="round"
                    ></path>
                    <path
                      d="M83.815554,15.9396386 C83.815554,15.9396386 89.117554,17.5606386 85.362554,22.1626386 C81.606554,26.7646386 81.625554,32.7176386 85.261554,35.0436386"
                      id="Stroke-652"
                      stroke="#574A34"
                      stroke-width="2.96"
                      stroke-linecap="round"
                    ></path>
                    <path
                      d="M104.361254,3.7249386 C104.361254,3.7249386 102.373254,-0.408061402 99.943254,0.0329385983 C97.512254,0.474938598 95.303254,4.1909386 95.966254,7.3039386 C96.629254,10.4169386 97.716254,15.2229386 95.847254,17.7899386 C93.978254,20.3579386 85.804254,27.9189386 90.001254,34.1899386"
                      id="Stroke-654"
                      stroke="#574A34"
                      stroke-width="2.96"
                      stroke-linecap="round"
                    ></path>
                    <path
                      d="M78.127554,3.7249386 C78.127554,3.7249386 68.882554,7.2139386 70.610554,12.7459386 C72.337554,18.2789386 76.845554,18.1799386 75.811554,25.4919386 C74.778554,32.8029386 74.010554,32.0899386 75.425554,34.1899386"
                      id="Stroke-656"
                      stroke="#574A34"
                      stroke-width="3.099"
                      stroke-linecap="round"
                    ></path>
                  </g>
                </g>
              </g>
            </svg>
            <span class="text-sm font-bold"
              >{{
                cartTotalPrice.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })
              }}
              €</span
            >
          </template>
        </UiButton>
      </nav>
    </template>
    <template #fscart>
      <UiButton
        class="cart-button group relative text-secondary-500 hover:text-white active:text-white hover:bg-primary-800 active:bg-primary-700 mr-1 -ml-0.5 rounded-md"
        :tag="NuxtLink"
        :to="localePath(paths.cart)"
        :aria-label="t('numberInCart', { count: cartItemsCount })"
        variant="tertiary"
        square
      >
        <p class="cartItemsCount p-5" v-if="cartItemsCount >= 0">Hier ist die Null</p>
        <p class="cartItemsCount v-els p-5" v-else>MEHR ALS NULL</p>
        <template #prefix>
          <svg
            v-if="cartItemsCount >= 0"
            xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink"
            width="113px"
            class="inline-block fill-current w-6 h-6"
            viewBox="0 0 113 111"
            version="1.1"
          >
            <path
              d="M102.311854,34.6661377 L46.592854,34.6661377 L54.654854,65.4621377 L94.412854,65.6871377 L102.311854,34.6661377 Z M43.331854,29.3851377 C62.770854,30.2281377 83.737854,27.8891377 103.003854,29.2581377 C105.233854,29.4161377 108.793854,29.5921377 108.518854,32.5311377 C105.411854,42.1001377 103.614854,52.0611377 100.835854,61.7151377 C99.764854,65.4351377 99.459854,70.2061377 94.918854,70.6231377 C81.938854,71.8171377 67.161854,69.6701377 53.985854,70.6231377 C52.056854,70.7311377 50.405854,69.3611377 49.853854,67.5671377 C48.267854,56.7451377 41.930854,43.5001377 40.847854,32.9661377 C40.625854,30.8061377 41.133854,29.7831377 43.331854,29.3851377 L43.331854,29.3851377 Z"
            ></path>
            <path
              d="M105.470754,80.7955377 C109.902754,82.5945377 108.902754,90.3054637 104.514754,90.2275377 C85.791754,88.9725377 63.399754,91.3235377 44.916754,89.7265377 C38.570754,89.1785377 33.545754,82.4815377 31.576754,76.3965377 L16.587754,19.9175377 C16.057754,17.6245377 13.686754,16.4315377 11.478754,15.9665377 C8.72375404,15.3865377 -1.19724596,17.6215377 0.119754043,10.7145377 C0.809754043,7.09753767 9.76975404,6.11053767 12.074754,6.33753767 C21.577754,7.27353767 25.550754,16.6445377 27.389754,22.6795377 C32.304754,38.8025377 34.978754,55.3295377 40.489754,70.9955377 C42.197754,75.8505377 42.843754,79.5445377 48.436754,80.1745377 C65.921754,82.1415377 85.011754,78.6485377 102.842754,80.1525377 C103.622754,80.2185377 104.742754,80.5005377 105.470754,80.7955377 Z"
            ></path>
            <path
              d="M51.867354,96.9842377 C46.252354,98.2122377 47.985354,108.203238 54.282354,107.325238 C60.811354,106.415238 59.832354,95.2422377 51.867354,96.9842377"
            ></path>
            <path
              d="M85.781654,96.9875377 C79.231654,98.4175377 82.371654,108.283538 88.098654,107.241538 C94.700654,106.039538 93.704654,95.2585377 85.781654,96.9875377"
            ></path>
            <line x1="25.864854" y1="18.4374377" x2="17.210854" y2="22.2654377"></line>
            <line x1="32.738454" y1="40.6853377" x2="23.440454" y2="42.4403377"></line>
            <line x1="40.800254" y1="69.2401377" x2="31.502254" y2="70.9951377"></line>
            <line x1="47.055254" y1="81.7555377" x2="44.065254" y2="90.7335377"></line>
            <line x1="74.557854" y1="81.0870377" x2="74.776854" y2="90.5470377"></line>
            <line x1="97.489054" y1="81.0870377" x2="97.708054" y2="90.5470377"></line>
            <path
              d="M7.91035404,0.124437674 C4.11235404,0.955437674 5.28435404,7.71443767 9.54435404,7.12043767 C13.961354,6.50443767 13.299354,-1.05356233 7.91035404,0.124437674"
            ></path>
            <path
              d="M11.948654,3.70313767 C8.15065404,4.53413767 9.32265404,11.2931377 13.582654,10.6991377 C17.999654,10.0831377 17.337654,2.52513767 11.948654,3.70313767"
            ></path>
          </svg>
          <svg
            v-else
            version="1.1"
            viewBox="0 0 120 115"
            height="115px"
            width="120px"
            xmlns:xlink="http://www.w3.org/1999/xlink"
            xmlns="http://www.w3.org/2000/svg"
          >
            <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
              <g id="Shopping-Ansätze-02" transform="translate(-940, -367)">
                <g id="Group-2" transform="translate(942.4545, 369.3792)">
                  <path
                    d="M102.311854,38.3911386 L46.593854,38.3911386 L54.654854,69.1871386 L94.412854,69.4121386 L102.311854,38.3911386 Z M43.331854,33.1101386 C62.770854,33.9531386 83.737854,31.6141386 103.003854,32.9831386 C105.233854,33.1411386 108.793854,33.3171386 108.518854,36.2561386 C105.411854,45.8251386 103.614854,55.7861386 100.835854,65.4401386 C99.764854,69.1601386 99.459854,73.9311386 94.918854,74.3481386 C81.938854,75.5421386 67.161854,73.3951386 53.985854,74.3481386 C52.056854,74.4561386 50.405854,73.0861386 49.854854,71.2921386 C48.267854,60.4701386 41.930854,47.2251386 40.847854,36.6911386 C40.625854,34.5311386 41.133854,33.5081386 43.331854,33.1101386 L43.331854,33.1101386 Z"
                    id="Fill-602"
                    fill="#574A34"
                  ></path>
                  <path
                    d="M102.311854,38.3911386 L46.593854,38.3911386 L54.654854,69.1871386 L94.412854,69.4121386 L102.311854,38.3911386 Z M43.331854,33.1101386 C62.770854,33.9531386 83.737854,31.6141386 103.003854,32.9831386 C105.233854,33.1411386 108.793854,33.3171386 108.518854,36.2561386 C105.411854,45.8251386 103.614854,55.7861386 100.835854,65.4401386 C99.764854,69.1601386 99.459854,73.9311386 94.918854,74.3481386 C81.938854,75.5421386 67.161854,73.3951386 53.985854,74.3481386 C52.056854,74.4561386 50.405854,73.0861386 49.854854,71.2921386 C48.267854,60.4701386 41.930854,47.2251386 40.847854,36.6911386 C40.625854,34.5311386 41.133854,33.5081386 43.331854,33.1101386 Z"
                    id="Stroke-604"
                    stroke="#574A34"
                    stroke-width="0.25"
                  ></path>
                  <path
                    d="M105.470754,84.5205386 C109.902754,86.3195386 108.902754,94.0304646 104.514754,93.9525386 C85.791754,92.6975386 63.399754,95.0485386 44.916754,93.4515386 C38.570754,92.9035386 33.545754,86.2065386 31.576754,80.1215386 L16.587754,23.6425386 C16.057754,21.3495386 13.686754,20.1565386 11.478754,19.6915386 C8.72375404,19.1115386 -1.19724596,21.3465386 0.119754043,14.4395386 C0.809754043,10.8225386 9.76975404,9.8355386 12.074754,10.0625386 C21.578754,10.9985386 25.550754,20.3695386 27.389754,26.4045386 C32.304754,42.5275386 34.978754,59.0545386 40.489754,74.7205386 C42.197754,79.5755386 42.843754,83.2695386 48.436754,83.8995386 C65.921754,85.8665386 85.011754,82.3735386 102.842754,83.8775386 C103.622754,83.9435386 104.743754,84.2255386 105.470754,84.5205386 Z"
                    id="Stroke-606"
                    stroke="#574A34"
                    stroke-width="4"
                  ></path>
                  <path
                    d="M51.867454,100.709239 C46.252454,101.937239 47.985454,111.928239 54.282454,111.050239 C60.811454,110.140239 59.832454,98.9672386 51.867454,100.709239"
                    id="Fill-608"
                    fill="#574A34"
                  ></path>
                  <path
                    d="M51.867454,100.709239 C46.252454,101.937239 47.985454,111.928239 54.282454,111.050239 C60.811454,110.140239 59.832454,98.9672386 51.867454,100.709239 Z"
                    id="Stroke-610"
                    stroke="#574A34"
                    stroke-width="1.521"
                  ></path>
                  <path
                    d="M85.781654,100.712539 C79.231654,102.142539 82.371654,112.008539 88.098654,110.966539 C94.700654,109.764539 93.704654,98.9835386 85.781654,100.712539"
                    id="Fill-612"
                    fill="#574A34"
                  ></path>
                  <path
                    d="M85.781654,100.712539 C79.231654,102.142539 82.371654,112.008539 88.098654,110.966539 C94.700654,109.764539 93.704654,98.9835386 85.781654,100.712539 Z"
                    id="Stroke-614"
                    stroke="#574A34"
                    stroke-width="1.523"
                  ></path>
                  <line
                    x1="25.864954"
                    y1="22.1624386"
                    x2="17.210954"
                    y2="25.9904386"
                    id="Stroke-616"
                    stroke="#574A34"
                    stroke-width="4"
                  ></line>
                  <line
                    x1="32.738454"
                    y1="44.4103386"
                    x2="23.440454"
                    y2="46.1653386"
                    id="Stroke-618"
                    stroke="#574A34"
                    stroke-width="4"
                  ></line>
                  <line
                    x1="40.800354"
                    y1="72.9651386"
                    x2="31.502354"
                    y2="74.7201386"
                    id="Stroke-620"
                    stroke="#574A34"
                    stroke-width="4"
                  ></line>
                  <line
                    x1="47.055254"
                    y1="85.4805386"
                    x2="44.065254"
                    y2="94.4585386"
                    id="Stroke-622"
                    stroke="#574A34"
                    stroke-width="4"
                  ></line>
                  <line
                    x1="74.557954"
                    y1="84.8120386"
                    x2="74.776954"
                    y2="94.2720386"
                    id="Stroke-624"
                    stroke="#574A34"
                    stroke-width="4"
                  ></line>
                  <line
                    x1="97.489054"
                    y1="84.8120386"
                    x2="97.708054"
                    y2="94.2720386"
                    id="Stroke-626"
                    stroke="#574A34"
                    stroke-width="4"
                  ></line>
                  <path
                    d="M7.91045404,3.8494386 C4.11245404,4.6804386 5.28445404,11.4394386 9.54445404,10.8454386 C13.961454,10.2294386 13.299454,2.6714386 7.91045404,3.8494386"
                    id="Fill-628"
                    fill="#EDE9DA"
                  ></path>
                  <path
                    d="M7.91045404,3.8494386 C4.11245404,4.6804386 5.28445404,11.4394386 9.54445404,10.8454386 C13.961454,10.2294386 13.299454,2.6714386 7.91045404,3.8494386 Z"
                    id="Stroke-630"
                    stroke="#574A34"
                    stroke-width="2.424"
                  ></path>
                  <path
                    d="M11.948754,7.4281386 C8.15075404,8.2591386 9.32275404,15.0181386 13.582754,14.4241386 C17.999754,13.8081386 17.337754,6.2501386 11.948754,7.4281386"
                    id="Fill-632"
                    fill="#EDE9DA"
                  ></path>
                  <path
                    d="M11.948754,7.4281386 C8.15075404,8.2591386 9.32275404,15.0181386 13.582754,14.4241386 C17.999754,13.8081386 17.337754,6.2501386 11.948754,7.4281386 Z"
                    id="Stroke-634"
                    stroke="#574A34"
                    stroke-width="2.424"
                  ></path>
                  <path
                    d="M27.533154,4.2983386 C27.533154,4.2983386 34.656154,1.6013386 36.182154,7.9063386 C37.707154,14.2113386 35.500154,15.9993386 38.158154,20.6163386 C40.815154,25.2333386 47.598154,27.1893386 46.467154,34.8303386"
                    id="Stroke-636"
                    stroke="#574A34"
                    stroke-width="3.172"
                    stroke-linecap="round"
                  ></path>
                  <g id="Group-641" transform="translate(42.3063, 5.7333)">
                    <path
                      d="M5.75052079,0 C5.75052079,0 -3.08847921,4.239 1.15052079,11.021 C5.38952079,17.804 13.0205208,22.869 7.65052079,29.097"
                      id="Fill-638"
                      fill="#EDE9DA"
                    ></path>
                    <path
                      d="M5.75052079,0 C5.75052079,0 -3.08847921,4.239 1.15052079,11.021 C5.38952079,17.804 13.0205208,22.869 7.65052079,29.097"
                      id="Stroke-640"
                      stroke="#574A34"
                      stroke-width="3.172"
                      stroke-linecap="round"
                    ></path>
                  </g>
                  <path
                    d="M50.695354,16.4977386 C50.695354,16.4977386 52.672354,11.7167386 56.165354,13.9237386 C59.659354,16.1297386 55.614354,20.5617386 57.085354,23.1267386 C58.556354,25.6917386 59.843354,31.6107386 56.349354,34.8107386"
                    id="Stroke-642"
                    stroke="#574A34"
                    stroke-width="3.172"
                    stroke-linecap="round"
                  ></path>
                  <path
                    d="M70.610354,35.0433386 C70.610354,35.0433386 61.207354,34.1883386 62.488354,26.3953386 C63.769354,18.6023386 68.692354,11.2223386 61.642354,7.3033386"
                    id="Stroke-644"
                    stroke="#574A34"
                    stroke-width="3.099"
                    stroke-linecap="round"
                  ></path>
                  <path
                    d="M72.653154,52.9043386 C72.653154,52.9043386 78.384154,50.5323386 76.819154,47.0383386 C75.254154,43.5443386 70.289154,38.1023386 72.653154,35.9163386"
                    id="Stroke-646"
                    stroke="#574A34"
                    stroke-width="3.099"
                    stroke-linecap="round"
                  ></path>
                  <path
                    d="M96.764854,34.1902386 C96.764854,34.1902386 92.338854,30.5372386 94.627854,27.5362386 C96.916854,24.5352386 102.706854,20.4632386 101.196854,17.7902386"
                    id="Stroke-648"
                    stroke="#574A34"
                    stroke-width="2.96"
                    stroke-linecap="round"
                  ></path>
                  <path
                    d="M115.849154,52.0314386 C115.849154,52.0314386 109.221154,50.5684386 110.989154,44.4104386 C112.756154,38.2524386 114.808154,31.4044386 110.689154,29.8574386 C106.570154,28.3114386 100.577154,33.4414386 101.444154,35.9164386"
                    id="Stroke-650"
                    stroke="#574A34"
                    stroke-width="2.96"
                    stroke-linecap="round"
                  ></path>
                  <path
                    d="M83.815554,15.9396386 C83.815554,15.9396386 89.117554,17.5606386 85.362554,22.1626386 C81.606554,26.7646386 81.625554,32.7176386 85.261554,35.0436386"
                    id="Stroke-652"
                    stroke="#574A34"
                    stroke-width="2.96"
                    stroke-linecap="round"
                  ></path>
                  <path
                    d="M104.361254,3.7249386 C104.361254,3.7249386 102.373254,-0.408061402 99.943254,0.0329385983 C97.512254,0.474938598 95.303254,4.1909386 95.966254,7.3039386 C96.629254,10.4169386 97.716254,15.2229386 95.847254,17.7899386 C93.978254,20.3579386 85.804254,27.9189386 90.001254,34.1899386"
                    id="Stroke-654"
                    stroke="#574A34"
                    stroke-width="2.96"
                    stroke-linecap="round"
                  ></path>
                  <path
                    d="M78.127554,3.7249386 C78.127554,3.7249386 68.882554,7.2139386 70.610554,12.7459386 C72.337554,18.2789386 76.845554,18.1799386 75.811554,25.4919386 C74.778554,32.8029386 74.010554,32.0899386 75.425554,34.1899386"
                    id="Stroke-656"
                    stroke="#574A34"
                    stroke-width="3.099"
                    stroke-linecap="round"
                  ></path>
                </g>
              </g>
            </g>
          </svg>
          <span class="text-sm font-bold text-nowrap"
            >{{
              cartTotalPrice.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })
            }}
            €</span
          >
        </template>
      </UiButton>
    </template>
    <template #fsuser>
      <SfDropdown v-if="isAuthorized" v-model="isAccountDropdownOpen" placement="bottom-end" class="z-50">
        <template #trigger>
          <UiButton
            variant="tertiary"
            class="relative text-secondary-500 hover:text-white active:text-white hover:bg-primary-800 active:bg-primary-700 rounded-md"
            :class="{ 'bg-primary-700': isAccountDropdownOpen }"
            data-testid="account-dropdown-button"
            @click="accountDropdownToggle()"
          >
            <template #prefix>
              <SfIconPerson />
            </template>
            {{ user.user?.firstName }}
          </UiButton>
        </template>
        <ul class="rounded bg-white shadow-md border border-neutral-100 text-neutral-900 min-w-[152px] py-2">
          <li v-for="({ label, link }, labelIndex) in accountDropdown" :key="`label-${labelIndex}`">
            <template v-if="label === t('account.logout')">
              <UiDivider class="my-2" />
              <SfListItem tag="button" class="text-left" data-testid="account-dropdown-logout-item" @click="logOut()">
                {{ label }}
              </SfListItem>
            </template>
            <SfListItem
              v-else
              :tag="NuxtLink"
              :to="link"
              :class="{ 'bg-neutral-200': route.path === link }"
              data-testid="account-dropdown-list-item"
            >
              {{ label }}
            </SfListItem>
          </li>
        </ul>
      </SfDropdown>
      <UiButton
        v-else
        class="group relative text-secondary-500 hover:text-white active:text-white hover:bg-primary-800 active:bg-primary-700 mr-1 -ml-0.5 rounded-md"
        variant="tertiary"
        :aria-label="t('auth.login.openLoginForm')"
        square
        @click="navigateToLogin"
      >
        <SfIconPerson />
      </UiButton>
    </template>

    <template #fswish>
      <UiButton
        class="group relative text-secondary-500 hover:text-white active:text-white hover:bg-primary-800 active:bg-primary-700 mr-1 -ml-0.5 rounded-md"
        :tag="NuxtLink"
        :to="localePath(paths.wishlist)"
        :aria-label="t('numberInWishlist', { count: wishlistItemIds.length })"
        variant="tertiary"
        square
        data-testid="wishlist-page-navigation"
      >
        <template #prefix>
          <SfIconFavoriteFilled v-if="wishlistItemIds.length > 0" />
          <SfIconFavorite v-else />
        </template>
      </UiButton>
    </template>
  </MegaMenu>
  <LanguageSelector />
  <UiModal
    v-if="viewport.isGreaterOrEquals('md') && isAuthenticationOpen"
    v-model="isAuthenticationOpen"
    tag="section"
    class="h-full md:w-[500px] md:h-fit m-0 p-0 overflow-y-auto"
  >
    <header>
      <UiButton
        :aria-label="$t('closeDialog')"
        square
        variant="tertiary"
        class="absolute right-2 top-2"
        @click="closeAuthentication"
      >
        <SfIconClose />
      </UiButton>
    </header>
    <LoginComponent v-if="isLogin" :is-modal="true" @change-view="isLogin = false" @logged-in="closeAuthentication" />
    <Register v-else :is-modal="true" @change-view="isLogin = true" @registered="closeAuthentication" />
  </UiModal>

  <NuxtLazyHydrate when-idle>
    <SfModal
      v-model="isSearchModalOpen"
      class="w-full h-full z-50"
      tag="section"
      role="dialog"
      aria-labelledby="search-modal-title"
    >
      <header class="mb-4">
        <UiButton square variant="tertiary" class="absolute right-4 top-2" @click="searchModalClose">
          <SfIconClose class="text-neutral-500" />
        </UiButton>
        <h3 id="search-modal-title" class="absolute left-6 top-4 font-bold typography-headline-4 mb-4">
          {{ t('search') }}
        </h3>
      </header>
      <UiSearch :close="searchModalClose" />
    </SfModal>
  </NuxtLazyHydrate>
</template>

<script setup lang="ts">
import {
  SfBadge,
  SfDropdown,
  SfIconClose,
  SfIconLanguage,
  SfIconPerson,
  SfIconSearch,
  SfIconShoppingCart,
  SfIconTune,
  SfListItem,
  SfModal,
  SfIconFavorite,
  SfIconFavoriteFilled,
  useDisclosure,
  SfIconCall,
  SfIconEmail,
} from '@storefront-ui/vue';
import LanguageSelector from '~/components/LanguageSelector/LanguageSelector.vue';
import { paths } from '~/utils/paths';

const isLogin = ref(true);
const { data: cart } = useCart();
const { wishlistItemIds } = useWishlist();
const cartItemsCount = ref(0);

const NuxtLink = resolveComponent('NuxtLink');
const { t, localeCodes } = useI18n();
const route = useRoute();
const localePath = useLocalePath();
const { isOpen: isAccountDropdownOpen, toggle: accountDropdownToggle } = useDisclosure();
const { isOpen: isAuthenticationOpen, open: openAuthentication, close: closeAuthentication } = useDisclosure();
const { open: searchModalOpen, isOpen: isSearchModalOpen, close: searchModalClose } = useDisclosure();

const { toggle: toggleLanguageSelect, isOpen: isLanguageSelectOpen } = useLocalization();
const { data: categoryTree } = useCategoryTree();
const { data: user, isAuthorized, logout } = useCustomer();
const viewport = useViewport();
const runtimeConfig = useRuntimeConfig();
const showConfigurationDrawer = runtimeConfig.public.showConfigurationDrawer;
const { isEditing, disableActions } = useEditor();

onNuxtReady(() => {
  cartItemsCount.value = cart.value?.items?.reduce((price, { quantity }) => price + quantity, 0) ?? 0;
});

const { isOpen, open, close } = useDisclosure();
const cartTotalPrice = computed(() => {
  return cart.value?.items?.reduce((total, { quantity, price }) => total + quantity * price, 0) ?? 0;
});

watch(
  () => cart.value?.items,
  (cartItems) => {
    // Anzahl der Artikel berechnen
    cartItemsCount.value = cartItems?.reduce((count, { quantity }) => count + quantity, 0) ?? 0;

    // Entferne diese Zeile, da cartTotalPrice automatisch aktualisiert wird:
    // cartTotalPrice.value = cartItems?.reduce((total, { quantity, price }) => total + quantity * price, 0) ?? 0;
  },
);

watch(
  () => isAuthenticationOpen.value,
  async () => {
    isLogin.value = true;
  },
);

const logOut = async () => {
  accountDropdownToggle();
  await logout();
  navigateTo(localePath(paths.home));
};

const accountDropdown = computed(() => [
  {
    label: t('account.heading'),
    link: localePath(paths.account),
  },
  {
    label: t('account.ordersAndReturns.section.myOrders'),
    link: localePath(paths.accountMyOrders),
  },
  {
    label: t('account.ordersAndReturns.section.returns'),
    link: localePath(paths.accountReturns),
  },
  {
    label: t('account.logout'),
  },
]);
const navigateToLogin = () => {
  if (route.path !== localePath(paths.authLogin)) {
    openAuthentication();
  }
};

const isContactModalOpen = ref(false);

const openContactModal = () => {
  isContactModalOpen.value = true;
};

const closeContactModal = () => {
  isContactModalOpen.value = false;
};
</script>
