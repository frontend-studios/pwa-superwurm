<template>
  <div class="fs-homepage px-1 md:px-md-0">
    <div class="max-w-screen-2xl relative mx-auto border-25 video-container">
      <video id="introVideo" class="border-25 mb-2" autoplay loop muted>
        <source
          src="https://cdn02.plentymarkets.com/ln590pyonzot/frontend/PWA_Superwurm/prev_images/Superwurm_Website.mp4"
          type="video/mp4"
        />
        Dein Browser unterst√ºtzt kein HTML5-Video.
      </video>
      <div class="wrapper absolute">
        <span class="mb-0 block font-bold">SUPERWURM</span>
        <span class="custom-font text-4xl xl:text-7xl font-bold block">Deutschlands gr√∂√üte Wurmfarm</span>
      </div>
    </div>

    <div class="max-w-screen-2xl relative mx-auto my-5 lg:my-10 text-center">
      <span class="mb-0 block font-bold text-secondary-500 xl:text-2xl">Willkommen bei Superwurm</span>
      <span class="custom-font text-4xl text-secondary-500 xl:text-5xl font-bold block"
        >Finde die perfekten Produkte f√ºr deinen Garten, <br />deine Tiere und dein Hobby
      </span>
    </div>

    <NuxtLazyHydrate when-visible>
      <div class="max-w-screen-2xl relative mx-auto md:grid md:grid-cols-2 lg:grid-cols-3 gap-2">
        <div class="relative hero md:row-span-2 md:col-span-2 mb-2 md:mb-0">
          <a href="/angelwuermer"
            ><img
              class="border-25"
              src="https://cdn02.plentymarkets.com/ln590pyonzot/frontend/PWA_Superwurm/prev_images/angelwuermer-fischer-boot-nebel.png"
              alt="Ein Fischer in einem kleinen Boot auf einem ruhigen See, umgeben von Nebel, perfekt f√ºr das Angeln mit Angelw√ºrmern."
              width="1024"
              height="1024"
            />
            <div class="cat-wrapper absolute">
              <span class="mb-0 block font-bold">ANGELW√úRMER</span>
              <span class="custom-font text-4xl xl:text-7xl font-bold block lg:mb-7"> Der perfekte K√∂der</span>
              <span class="block font-bold">Fange mehr - Entdecke unsere hochwertigen Angelw√ºrmer!</span>
              <button
                href="/angelwuermer"
                class="btn border-25 bg-custom text-secondary-500 font-bold px-4 py-3 mt-4 hover:text-white hover:bg-secondary-500 border-2"
              >
                <span>Zu den Angelw√ºrmern!</span>
              </button>
            </div>
          </a>
        </div>

        <div class="single-cat mb-2 md:mb-0">
          <a href="/garten-kompost/gartenwuermer"
            ><img
              class="border-25"
              src="https://cdn02.plentymarkets.com/ln590pyonzot/frontend/PWA_Superwurm/prev_images/gartenwuermer-erde-pflanzen.png"
              alt="Rote W√ºrmer in fruchtbarer Erde zwischen frischen, gr√ºnen Pflanzen ‚Äì ideale Gartenw√ºrmer f√ºr gesunden Boden."
              width="500"
              height="360"
            />
            <div class="cat-wrapper absolute">
              <span class="custom-font text-4xl xl:text-6xl font-bold block text-wrap">Garten w√ºrmer</span>
              <button
                href="/garten-kompost/gartenwuermer"
                class="btn border-25 bg-custom text-secondary-500 font-bold px-4 py-3 mt-4 hover:text-white hover:bg-secondary-500 border-2"
              >
                <span>Zu den Gartenw√ºrmer!</span>
              </button>
            </div>
          </a>
        </div>
        <div class="single-cat primary mb-2 md:mb-0">
          <a href="/futterwuermer"
            ><img
              class="border-25"
              src="https://cdn02.plentymarkets.com/ln590pyonzot/frontend/PWA_Superwurm/prev_images/futterwuermer-schale-natur.png"
              alt="Eine Schale mit lebenden Futterw√ºrmern in nat√ºrlicher Umgebung, perfekt als Nahrungsquelle f√ºr Reptilien und V√∂gel."
              width="500"
              height="360"
            />
            <div class="cat-wrapper absolute">
              <span class="custom-font text-4xl xl:text-6xl font-bold block">Futter w√ºrmer</span>
              <button
                href="/futterwuermer"
                class="btn border-25 bg-custom text-secondary-500 font-bold px-4 py-3 mt-4 hover:text-white hover:bg-secondary-500 border-2"
              >
                <span>Zu den Futterw√ºrmern!</span>
              </button>
            </div>
          </a>
        </div>
      </div>
    </NuxtLazyHydrate>
    <div
      class="max-w-screen-2xl mx-auto relative mt-2 mb-5 lg:mb-10 flex overflow-x-scroll scrollbar-hidden md:grid md:grid-cols-2 lg:grid-cols-3 gap-2"
    >
      <div
        v-for="{ title, title2nd, image, link, btntext, alt } in categories"
        :key="title"
        class="single-cat mb-2 md:mb-0"
      >
        <a :href="link">
          <img class="border-25" :src="image" :alt="alt" width="500" height="360" />
          <div class="cat-wrapper absolute">
            <span class="custom-font text-4xl xl:text-6xl font-bold block">{{ title }} <br />{{ title2nd }}</span>
            <button
              :href="link"
              class="btn block border-25 bg-custom text-secondary-500 font-bold px-4 py-3 mt-4 hover:text-white hover:bg-secondary-500 border-2"
            >
              <span>{{ btntext }}</span>
            </button>
          </div>
        </a>
      </div>
    </div>

    <div class="max-w-screen-2xl mx-auto relative social-icons mb-5 md:mb-10">
      <div class="grid grid-cols-4 gap-2 bg-secondary-500 border-25 md:bg-transparent md:rounded-none">
        <div
          class="bg-secondary-500 border-25 w-full text-center text-custom border-secondary-500 border-2 hover:text-secondary-500 social-item"
        >
          <a href="https://www.facebook.com/Wurmfarm/" target="_blank">
            <div class="py-2">
              <span class="font-bold flex items-center justify-center"
                ><SfIconFacebook class="mr-2" size="base" />
                <span v-if="viewport.isGreaterOrEquals('sm')">Facebook</span>
              </span>
            </div>
          </a>
        </div>
        <div
          class="bg-secondary-500 border-25 w-full text-center text-custom border-secondary-500 border-2 hover:text-secondary-500 social-item"
        >
          <a href="https://www.youtube.com/user/SuperwurmTV" target="_blank">
            <div class="py-2">
              <span class="font-bold flex items-center justify-center"
                ><SfIconYoutube class="mr-2" size="base" /> <span v-if="viewport.isGreaterOrEquals('sm')">Youtube</span>
              </span>
            </div>
          </a>
        </div>
        <div
          class="bg-secondary-500 border-25 w-full text-center text-custom border-secondary-500 border-2 hover:text-secondary-500 social-item"
        >
          <a href="https://www.instagram.com/superwurm.de/" target="_blank">
            <div class="py-2">
              <span class="font-bold flex items-center justify-center"
                ><SfIconInstagram class="mr-2" size="base" />
                <span v-if="viewport.isGreaterOrEquals('sm')">Instagram</span>
              </span>
            </div>
          </a>
        </div>
        <div
          class="bg-secondary-500 border-25 w-full text-center text-custom border-secondary-500 border-2 hover:text-secondary-500 social-item"
        >
          <a href="https://www.tiktok.com/@superwurm.de" target="_blank">
            <div class="py-2">
              <span class="font-bold flex items-center justify-center"
                ><img
                  src="https://cdn02.plentymarkets.com/ln590pyonzot/frontend/PWA_Superwurm/TikTok_SocialMediaIcon.png"
                  alt="tiktok"
                  class="mr-2"
                />
                <span v-if="viewport.isGreaterOrEquals('sm')">TikTok</span>
              </span>
            </div>
          </a>
        </div>
      </div>
    </div>

    <NuxtLazyHydrate when-visible>
      <section class="max-w-screen-2xl mx-auto relative w-full items mb-5 md:mb-10">
        <div class="mx-3 lg:mx-0 mt-5 lg:mt-0 lg:mb-10 flex justify-between items-center">
          <div>
            <p class="mb-0 block text-secondary-500 font-bold">Bestseller</p>
            <p class="custom-font text-secondary-500 text-2xl md:text-4xl font-bold block">
              Alle Highlights auf einen Blick!
            </p>
          </div>
          <div>
            <a
              href="/haelterung-zubehoer"
              class="bg-secondary-500 border-25 w-full text-center text-custom border-secondary-500 border-2 hover:text-secondary-500 show-all py-4 px-5 hidden md:block text-sm font-bold"
              ><SfIconArrowForward class="mr-2" size="base" />Weitere Highlights</a
            >
          </div>
        </div>

        <div class="thumbs">
          <BlocksProductRecommendedProducts :text="{}" :category-id="customProductsCategoryId" />
        </div>
      </section>
    </NuxtLazyHydrate>

    <NuxtLazyHydrate when-visible>
      <section class="max-w-screen-2xl mx-auto relative w-full mb-5 md:mb-10">
        <div class="lazy-image-container">
          <a href="/garten-kompost/kompostwuermer">
            <NuxtImg :src="getImageUrl()" alt="Kompostw√ºrmer" class="w-full border-25" loading="lazy" />
            <div class="wrapper absolute">
              <p class="custom-font text-custom text-4xl lg:text-7xl font-bold mb-0">Maden</p>
              <button
                href="/garten-kompost/kompostwuermer"
                class="btn border-25 bg-custom text-secondary-500 font-bold px-4 py-3 mt-4 hover:text-white hover:bg-secondary-500 border-2"
              >
                <span>Zu unseren Maden!</span>
              </button>
            </div>
          </a>
        </div>
      </section>
    </NuxtLazyHydrate>

    <NuxtLazyHydrate when-visible>
      <section class="max-w-screen-2xl mx-auto relative w-full items mb-5 md:mb-10">
        <div class="mx-3 lg:mx-0 mt-5 lg:mt-0 lg:mb-10 flex justify-between items-center">
          <div>
            <p class="mb-0 block text-secondary-500 font-bold">KOMPOST- UND GARTENW√úRMER</p>
            <p class="custom-font text-secondary-500 text-2xl md:text-4xl font-bold block">
              F√ºr lockeren Boden und starken Kompost
            </p>
          </div>
          <div>
            <a
              href="/futterwuermer-zoo/futterwuermer"
              class="bg-secondary-500 border-25 w-full text-center text-custom border-secondary-500 border-2 hover:text-secondary-500 show-all py-4 px-5 hidden md:block text-sm font-bold"
              ><SfIconArrowForward class="mr-2" size="base" />Zu den W√ºrmern</a
            >
          </div>
        </div>

        <div class="thumbs">
          <BlocksProductRecommendedProducts :text="{}" :category-id="customProductsCategoryIdBottom" />
        </div>
      </section>
    </NuxtLazyHydrate>

    <NuxtLazyHydrate when-visible>
      <div
        class="max-w-screen-2xl mx-auto relative mt-2 mb-5 lg:mb-10 flex overflow-x-scroll scrollbar-hidden md:grid md:grid-cols-2 lg:grid-cols-3 gap-2"
      >
        <div
          v-for="{ title, title2nd, image, link, btntext, alt } in bottom_categories"
          :key="title"
          class="single-cat mb-2 md:mb-0"
        >
          <a :href="link">
            <img class="border-25" :src="image" :alt="alt" width="500" height="360" />
            <div class="cat-wrapper absolute">
              <span class="custom-font text-4xl xl:text-6xl font-bold block">{{ title }} <br />{{ title2nd }}</span>
              <button
                :href="link"
                class="btn block border-25 bg-custom text-secondary-500 font-bold px-4 py-3 mt-4 hover:text-white hover:bg-secondary-500 border-2"
              >
                <span>{{ btntext }}</span>
              </button>
            </div>
          </a>
        </div>
      </div>
    </NuxtLazyHydrate>

    <NuxtLazyHydrate when-visible>
      <section class="max-w-screen-2xl relative w-full mx-auto mb-5 lg:mb-10" id="bewertung">
        <p class="custom-font text-secondary-500 text-2xl lg:text-3xl font-bold block mx-3 lg:mx-0 mb-5 lg:mb-10">
          "ECHT WURMIG!" - DAS SAGEN UNSERE KUNDEN
        </p>
        <div
          class="flex overflow-x-scroll lg:grid lg:gap-2 lg:grid-cols-5 lg:overflow-auto scrollbar-hidden ml-3 lg:ml-0"
        >
          <div
            v-for="{ stars, name, text } in feedback"
            :key="name"
            class="feedback border-25 bg-white p-3 mb-3 md:mb-0 mr-2 lg:mr-0"
          >
            <div class="headline flex flex-wrap justify-between items-center mb-2">
              <div class="leading-3">
                <SfIconStarFilled size="xs" class="text-orange-400" />
                <SfIconStarFilled size="xs" class="text-orange-400 -ml-1" />
                <SfIconStarFilled size="xs" class="text-orange-400 -ml-1" />
                <SfIconStarFilled size="xs" class="text-orange-400 -ml-1" />
                <SfIconStarFilled size="xs" class="text-orange-400 -ml-1" v-if="stars === 5" />
                <span class="text-xs text-gray-400 ml-2">{{ name }}</span>
              </div>
              <SfIconCheckCircle class="text-primary-500" size="sm" />
            </div>
            <div class="text text-sm text-secondary-500">
              <span>{{ text }}</span>
            </div>
          </div>
        </div>
      </section>
    </NuxtLazyHydrate>

    <NuxtLazyHydrate when-visible>
      <section class="max-w-screen-2xl mx-auto relative mt-2 flex justify-center about">
        <p class="custom-font text-primary-500 text-2xl md:text-4xl font-bold block">24 Jahre SUPERWURM</p>
      </section>
      <section
        class="max-w-screen-2xl mx-auto relative mt-2 mb-5 px-3 lg:px-0 lg:mb-10 flex flex-wrap md:grid md:grid-cols-2 gap-2 about text-secondary-500"
      >
        <div>
          <p>
            <strong
              >Wir liefern Kompostw√ºrmer, Angelw√ºrmer, Futterw√ºrmer sowie Wurmhumus. Auf unserer Wurm-Farm z√ºchten wir
              Riesen-Rotw√ºrmer.</strong
            >
            <br />F√ºr Handel, Privat und Vereine.
          </p>
          <p>
            Als spezialisiertes Unternehmen f√ºr Kompostw√ºrmer, Angelw√ºrmer und Futterw√ºrmer w√ºrden wir auch Sie gerne
            als Kunden gewinnen. Nutzen Sie unser attraktives Angebot zu Ihrem Vorteil.
          </p>
          <p class="flex justify-center my-2">
            <img src="https://www.superwurm.de/images/ceres/stempel.gif" />
            <br />
          </p>
          <p>
            *Lebendgarantie gilt nur f√ºr Bestellungen innerhalb Deutschlands auf Dendrobena. Bei Temperaturen √ºber 25¬∞C
            wird nur auf eigenes Risiko versendet. Auslandsbestellungen laufen auf eigenes Risiko.
          </p>
        </div>
        <div>
          <p>
            <strong>Das Angebot:</strong> <br />Der Riesen-Rotwurm ist ein hervorragender Angelwurm und besticht durch
            seine Eigenschaften. Gerne und zunehmend wird er ebenso zur Kompostierung eingesetzt. Als Gartenwurm
            bel√ºftet er den Boden, baut Schwermetalle ab, erzeugt den wertvollen Wurmhumus und dient so als nat√ºrlicher
            Bodenverbesserer. F√ºr viele Tiere im Terrarium oder Aquarium, aber auch f√ºr V√∂gel, stellt der Riesen-Rotwurm
            eine sinnvolle Nahrungserg√§nzung dar.
          </p>
          <p>
            F√ºr Garten: Kompostw√ºrmer, Gartenw√ºrmer, Wurmhumus <br />F√ºr Angeln: Riesen-Rotw√ºrmer (Dendrobena);
            Kanadische Tauw√ºrmer <br />F√ºr Zoo: Futterw√ºrmer <br />F√ºr Jagd: Ablenkf√ºtterung
          </p>
        </div>
      </section>
    </NuxtLazyHydrate>
  </div>
</template>

<script lang="ts" setup>
// Adding SocialMedia Icons from https://docs.storefrontui.io/v2/vue/components/iconbase START
import {
  SfIconFacebook,
  SfIconYoutube,
  SfIconInstagram,
  SfIconArrowForward,
  SfIconCheckCircle,
  SfIconStarFilled,
} from '@storefront-ui/vue';
// Adding SocialMedia Icons from https://docs.storefrontui.io/v2/vue/components/iconbase ENDE

// Update const { data, fetchPageTemplate, dataIsEmpty } = useHomepage();
// Update const { $i18n } = useNuxtApp();

// Adding Items from specific Cat START
const { data: categoryTree } = useCategoryTree();
const customProductsCategoryId = ref('');
const customProductsCategoryIdBottom = ref('');

watch(
  () => categoryTree.value,
  async () => {
    const categoryIdTop = 847; // Hier die gew√ºnschte category.id setzen
    const categoryIdBottom = 848; // Neue ID f√ºr customProductsCategoryIdBottom
    customProductsCategoryId.value = categoryIdTop.toString();
    customProductsCategoryIdBottom.value = categoryIdBottom.toString();
  },
  { immediate: true },
);
// Adding Items from specific Cat ENDE

// Changing Images for different ViewPorts START
const viewport = useViewport();

const getImageUrl = () => {
  switch (viewport.breakpoint.value) {
    case '4xl': {
      return 'https://cdn02.plentymarkets.com/ln590pyonzot/frontend/PWA_Superwurm/prev_images/maden_desktop.jpg';
    }
    case '3xl': {
      return 'https://cdn02.plentymarkets.com/ln590pyonzot/frontend/PWA_Superwurm/prev_images/maden_desktop.jpg';
    }
    case '2xl': {
      return 'https://cdn02.plentymarkets.com/ln590pyonzot/frontend/PWA_Superwurm/prev_images/maden_desktop.jpg';
    }
    case 'xl': {
      return 'https://cdn02.plentymarkets.com/ln590pyonzot/frontend/PWA_Superwurm/prev_images/maden_desktop.jpg';
    }
    case 'lg': {
      return 'https://cdn02.plentymarkets.com/ln590pyonzot/frontend/PWA_Superwurm/prev_images/maden_desktop.jpg';
    }
    case 'md': {
      return 'https://cdn02.plentymarkets.com/ln590pyonzot/frontend/PWA_Superwurm/prev_images/maden_desktop.jpg';
    }
    case 'sm': {
      return 'https://cdn02.plentymarkets.com/ln590pyonzot/frontend/PWA_Superwurm/prev_images/maden_mobile.jpg';
    }
    default: {
      return 'https://cdn02.plentymarkets.com/ln590pyonzot/frontend/PWA_Superwurm/prev_images/maden_mobile.jpg';
    }
  }
};
// Changing Images for different ViewPorts ENDE

// Categorie Schleife
const categories = [
  {
    title: 'Mehl',
    title2nd: 'w√ºrmer',
    link: '/futterwuermer-zoo/futter-insekten/getrocknete-mehlwuermer',
    image:
      'https://cdn02.plentymarkets.com/ln590pyonzot/frontend/PWA_Superwurm/prev_images/getrocknete-mehlwuermer-schale.png',
    btntext: 'Zu den Mehlw√ºrmern!',
    alt: 'Eine Holzschale voller getrockneter Mehlw√ºrmer, eine proteinreiche Futterquelle f√ºr Wildv√∂gel und Haustiere.',
  },
  {
    title: 'Wurm',
    title2nd: 'zucht',
    link: '/wurmzucht',
    image:
      'https://cdn02.plentymarkets.com/ln590pyonzot/frontend/PWA_Superwurm/prev_images/wurmzucht-haende-erde-wuermer.png',
    btntext: 'Alles zur Wurmzucht!',
    alt: 'H√§nde graben in dunkler, feuchter Erde voller aktiver W√ºrmer ‚Äì das perfekte Bild f√ºr die Wurmzucht.',
  },
  {
    title: 'Kompost',
    title2nd: 'w√ºrmer',
    link: '/garten-kompost/kompostwuermer',
    image:
      'https://cdn02.plentymarkets.com/ln590pyonzot/frontend/PWA_Superwurm/prev_images/kompostwuermer-erde-organisch.png',
    btntext: 'Zu den Kompostw√ºrmern!',
    alt: 'Rote Kompostw√ºrmer in n√§hrstoffreichem Boden mit organischen Abf√§llen ‚Äì f√ºr eine nachhaltige Kompostierung',
  },
];

// Categorie Schleife
const bottom_categories = [
  {
    title: 'Terraverm',
    title2nd: 'Wurmhumus',
    link: '/garten-kompost/terraverm-wurmhumus',
    image:
      'https://cdn02.plentymarkets.com/ln590pyonzot/frontend/PWA_Superwurm/prev_images/terraverm-wurmhumus-schaufel.png',
    btntext: 'Zum Terraverm Wurmhumus!',
    alt: 'Terraverm Wurmhumus',
  },
  {
    title: 'Futter',
    title2nd: 'w√ºrmer',
    link: '/futterwuermer-zoo/futterwuermer',
    image: 'https://cdn02.plentymarkets.com/5kg2d8h6ucou/frontend/SuperwurmPWAAssets/5futterwuermer.png',
    btntext: 'Zu den Futterw√ºrmern!',
    alt: 'Futterw√ºrmer',
  },
  {
    title: 'Zubeh√∂r',
    title2nd: 'Artikel',
    link: '/haelterung-zubehoer',
    image: 'https://cdn02.plentymarkets.com/ln590pyonzot/frontend/PWA_Superwurm/prev_images/zubehoer_artikel.jpg',
    btntext: 'Zu unserem Zubeh√∂r!',
    alt: 'Zubeh√∂rartikel f√ºr die Wurmzucht',
  },
];

// Feedback Schleife
const feedback = [
  {
    stars: 5,
    name: 'T M',
    date: 'am 04.02.2024',
    text: 'Sch√∂ne gesunde und kr√§ftige Dendrobena. Nach 2 Wochen finden sich bereits jede Menge Kokons im Substrat.Das Futter ist nach 2 Tagen aufgebraucht und zeugt von gesunden Appetit.',
  },
  {
    stars: 5,
    name: 'Marion B',
    date: 'am 19.10.2024',
    text: 'Ich habe eine kleine Menge Regenw√ºrmer bestellt und die kleinen Helfer z√ºgig erhalten. Alle sind wohlauf , Dank der guten Verpackung und obwohl die Aussentemperaturen um 0Grad liegen. Da kann ich nur sagen: gerne wieder und empfehlenswert.',
  },
  {
    stars: 5,
    name: 'Petra V',
    date: 'am 02.04.2024',
    text: 'Wir kaufen seit einigen Jahren den Wurmhumus. Nutzen wir im gesamten Garten als D√ºnger, Bodenverbesserer. Suuuuper.',
  },
  {
    stars: 5,
    name: 'Schildkr√∂ten Ibbenb√ºren',
    date: 'am 04.02.2024',
    text: 'Wir haben ein Abo und erhalten mehrmals im Monat 400 W√ºrmer. Das funktioniert einwandfrei und die Qualit√§t der W√ºrmer ist super. Unsere Schildkr√∂ten freuen sich jedes Mal unheimlich auf die Lieferung. Vielen lieben Dank f√ºr die Zusammenarbeit.',
  },
  {
    stars: 5,
    name: 'Mar Vin',
    date: 'am 04.02.2024',
    text: 'Freundliche Mitarbeiter, faire Preise und die Qualit√§t ist immer top üëç',
  },
];

//neu nach Update
import { watchDebounced } from '@vueuse/core';
const { t } = useI18n();
const {
  isClicked,
  clickedBlockIndex,
  isTablet,
  isPreview,
  blockHasData,
  tabletEdit,
  deleteBlock,
  changeBlockPosition,
  isLastBlock,
  togglePlaceholder,
} = useBlockManager();

const { settingsIsDirty, openDrawerWithView, updateNewBlockPosition } = useSiteConfiguration();

const { data, fetchPageTemplate, dataIsEmpty, initialBlocks } = useHomepage();

const { isEditingEnabled, disableActions } = useEditor();
const { getRobots, setRobotForStaticPage } = useRobots();

const { setPageMeta } = usePageMeta();

const icon = 'home';
setPageMeta(t('homepage.title'), icon);
const openBlockList = (index: number, position: number) => {
  const insertIndex = (position === -1 ? index : index + 1) || 0;
  togglePlaceholder(index, position === -1 ? 'top' : 'bottom');
  updateNewBlockPosition(insertIndex);
  openDrawerWithView('blocksList');
};

await getRobots();
setRobotForStaticPage('Homepage');

onMounted(() => {
  isEditingEnabled.value = false;
  window.addEventListener('beforeunload', handleBeforeUnload);
});

onBeforeUnmount(() => {
  window.removeEventListener('beforeunload', handleBeforeUnload);
});

const hasUnsavedChanges = () => {
  return !isEditingEnabled.value && !settingsIsDirty.value;
};

const handleBeforeUnload = (event: BeforeUnloadEvent) => {
  if (hasUnsavedChanges()) return;
  event.preventDefault();
};

fetchPageTemplate();

watchDebounced(
  () => data.value.blocks,
  () => {
    isEditingEnabled.value = !deepEqual(initialBlocks.value, data.value.blocks);
  },
  { debounce: 100, deep: true },
);
</script>
